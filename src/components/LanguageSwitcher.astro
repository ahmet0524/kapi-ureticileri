---
// ============================================
// src/components/LanguageSwitcher.astro - With Flag Icons
// ============================================

import { getLangFromUrl } from '../i18n/utils';
import { languages, type Language } from '../i18n/languages';

const currentLang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname.replace(/^\/(en|ar)/, '');

// Languages object'i array'e çevir
const languageList = Object.entries(languages) as [Language, typeof languages[Language]][];

// Bayrak ikonları için SVG kullan
const flagIcons = {
  tr: `<svg viewBox="0 0 640 480" class="flag-icon"><rect width="640" height="480" fill="#e30a17"/><circle cx="270" cy="240" r="90" fill="#fff"/><circle cx="285" cy="240" r="72" fill="#e30a17"/><path d="M355 200l-25 77-65-48h80l-65 48z" fill="#fff"/></svg>`,
  en: `<svg viewBox="0 0 640 480" class="flag-icon"><path fill="#012169" d="M0 0h640v480H0z"/><path fill="#FFF" d="m75 0 244 181L562 0h78v62L400 241l240 178v61h-80L320 301 81 480H0v-60l239-178L0 64V0h75z"/><path fill="#C8102E" d="m424 281 216 159v40L369 281h55zm-184 20 6 35L54 480H0l240-179zM640 0v3L391 191l2-44L590 0h50zM0 0l239 176h-60L0 42V0z"/><path fill="#FFF" d="M241 0v480h160V0H241zM0 160v160h640V160H0z"/><path fill="#C8102E" d="M0 193v96h640v-96H0zM273 0v480h96V0h-96z"/></svg>`,
  ar: `<svg viewBox="0 0 640 480" class="flag-icon"><path fill="#199d00" d="M0 0h640v480H0z"/><path fill="#fff" d="M320 166.7c-27.6 0-50 26-50 58s22.4 58 50 58 50-26 50-58-22.4-58-50-58z"/><path fill="#199d00" d="M335 196.5c-16.5 0-30 15.5-30 34.7s13.5 34.8 30 34.8 30-15.6 30-34.8-13.5-34.7-30-34.7z"/><path fill="#fff" d="m307.8 217.4 6.7 20.5h21.6l-17.5 12.7 6.7 20.5-17.5-12.7-17.4 12.7 6.7-20.5-17.5-12.7h21.6z"/></svg>`
};
---

<div class="language-switcher">
  {languageList.map(([langCode, langData]) => {
    const href = langCode === 'tr' ? currentPath : `/${langCode}${currentPath}`;
    const isActive = langCode === currentLang;

    return (
      <a
        href={href}
        class:list={['lang-link', { active: isActive }]}
        hreflang={langCode}
        aria-current={isActive ? 'page' : undefined}
        aria-label={`${langData.name} diline geç`}
        title={langData.name}
      >
        <span class="lang-flag" set:html={flagIcons[langCode]}></span>
        <span class="lang-code">{langCode.toUpperCase()}</span>
      </a>
    );
  })}
</div>

<style>
  .language-switcher {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .lang-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.875rem;
    border-radius: 8px;
    text-decoration: none;
    color: #4b5563;
    font-weight: 500;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    border: 1px solid #e5e7eb;
    background: white;
  }

  .lang-link:hover {
    background: #f9fafb;
    color: #1f2937;
    border-color: #d1d5db;
  }

  .lang-link.active {
    background: #667eea;
    color: white;
    border-color: #667eea;
  }

  .lang-flag {
    display: flex;
    align-items: center;
    width: 24px;
    height: 18px;
  }

  .lang-flag :global(.flag-icon) {
    width: 100%;
    height: 100%;
    display: block;
    border-radius: 2px;
  }

  .lang-code {
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    min-width: 20px;
  }

  /* Mobil için */
  @media (max-width: 767px) {
    .language-switcher {
      justify-content: center;
      gap: 0.5rem;
      padding: 0.5rem 0;
      flex-wrap: wrap;
    }

    .lang-link {
      flex: 1;
      min-width: 90px;
      justify-content: center;
      padding: 0.625rem 1rem;
    }

    .lang-flag {
      width: 28px;
      height: 21px;
    }

    .lang-code {
      font-size: 0.875rem;
    }
  }

  /* Tablet için */
  @media (max-width: 1024px) and (min-width: 768px) {
    .language-switcher {
      gap: 0.375rem;
    }

    .lang-link {
      padding: 0.5rem 0.75rem;
    }
  }
</style>
