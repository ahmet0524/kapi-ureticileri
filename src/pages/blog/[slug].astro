---
// src/pages/blog/[slug].astro
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export const prerender = true;

export async function getStaticPaths() {
  const posts = await getCollection('article');

  console.log('üìÑ Olu≈üturulan article route\'larƒ±:');
  posts.forEach(post => {
    console.log(`  - /blog/${post.id}`);
  });

  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;

// Astro v5: render() fonksiyonunu import edin ve kullanƒ±n
const { Content } = await render(post);

const baseUrl = 'https://kapi-ureticileri.vercel.app';
const currentUrl = `${baseUrl}/blog/${post.id}`;

const allPosts = await getCollection('article');
const relatedPosts = allPosts
  .filter(p => p.id !== post.id)
  .filter(p => p.data.category === post.data.category)
  .slice(0, 3);
---

<Layout
  title={`${post.data.title} | CihanPan Door Blog`}
  description={post.data.description}
  canonical={currentUrl}
>
  <Header />

  <main class="blog-post-page">
    <article class="article-container">
      <div class="container">
        <div class="article-header">
          {post.data.category && (
            <span class="category-badge">{post.data.category}</span>
          )}
          <h1>{post.data.title}</h1>
          <div class="article-meta">
            <time datetime={post.data.pubDate.toISOString()}>
              üìÖ {post.data.pubDate.toLocaleDateString('tr-TR')}
            </time>
            {post.data.readTime && (
              <>
                <span class="separator">‚Ä¢</span>
                <span>‚è±Ô∏è {post.data.readTime}</span>
              </>
            )}
          </div>
        </div>

        <div class="article-content prose">
          <Content />
        </div>
      </div>
    </article>
  </main>

  <Footer />
</Layout>
